x

---

# ğŸ”¹ 1ï¸âƒ£ What `fs.createReadStream()` Really Does

When you call:

```js
const fs = require("fs");
const stream = fs.createReadStream("file.txt");
```

Internally Node:

1. Calls `fs.open()` (async, via libuv threadpool)
    
2. Gets a file descriptor (fd)
    
3. Creates a `ReadStream` instance
    
4. Starts calling internal `_read()` method
    
5. Reads chunks into internal buffer
    
6. Emits events (`data`, `end`, etc.)
    

It is implemented using the `Readable` class from:

```js
require("stream")
```

---

# ğŸ”¹ 2ï¸âƒ£ Full Syntax of `createReadStream`

```js
fs.createReadStream(path, options)
```

### Important Options (VERY important for interviews)

```js
{
  flags: 'r',
  encoding: null,
  fd: null,
  mode: 0o666,
  autoClose: true,
  start: 0,
  end: Infinity,
  highWaterMark: 64 * 1024
}
```

Letâ€™s break each deeply.

---

# ğŸ”¥ 3ï¸âƒ£ Important Options Explained

---

## 1ï¸âƒ£ `flags`

Default: `'r'`

This defines how file is opened.

Common flags:

|Flag|Meaning|
|---|---|
|`'r'`|read|
|`'r+'`|read + write|
|`'w'`|truncate and write|
|`'a'`|append|
|`'rs'`|read in sync mode (bypass OS cache)|

Example:

```js
fs.createReadStream("file.txt", { flags: "r" });
```

Interview tip:  
`rs` is rarely used â€” it bypasses OS cache (used in low-level systems).

---

## 2ï¸âƒ£ `encoding`

Default: `null`

If `null` â†’ you get `Buffer`  
If `"utf8"` â†’ you get string

Example:

```js
fs.createReadStream("file.txt", { encoding: "utf8" });
```

Without encoding:

```js
<Buffer 68 65 6c 6c 6f>
```

With encoding:

```js
"hello"
```

---

## 3ï¸âƒ£ `highWaterMark`

Controls internal buffer size before applying backpressure.

Default for file streams:

```
64 KB
```

Example:

```js
fs.createReadStream("file.txt", {
  highWaterMark: 1024 * 16 // 16 KB
});
```

Important:  
It does NOT limit file size.  
It controls internal buffering.

---

## 4ï¸âƒ£ `start` and `end`

Used for partial reading.

Example:

```js
fs.createReadStream("file.txt", {
  start: 0,
  end: 99
});
```

Reads first 100 bytes only.

Real-world use:

- Video streaming (range requests)
    
- Resume downloads
    
- Large file chunking
    

---

## 5ï¸âƒ£ `autoClose`

Default: `true`

If true:

- File descriptor closes automatically on `end` or `error`.
    

If false:

- You must manually close it.
    

Example:

```js
fs.createReadStream("file.txt", {
  autoClose: false
});
```

Then manually:

```js
stream.close();
```

---

# ğŸ”¹ 4ï¸âƒ£ Important Events of ReadStream

These are critical.

---

## ğŸ”¸ 1ï¸âƒ£ `open`

Fires when fd is ready.

```js
stream.on("open", (fd) => {
  console.log("File descriptor:", fd);
});
```

---

## ğŸ”¸ 2ï¸âƒ£ `data`

Triggers flowing mode.

```js
stream.on("data", (chunk) => {
  console.log(chunk);
});
```

---

## ğŸ”¸ 3ï¸âƒ£ `readable`

Paused mode event.

```js
stream.on("readable", () => {
  let chunk;
  while ((chunk = stream.read()) !== null) {
    console.log(chunk);
  }
});
```

This is manual pulling.

---

## ğŸ”¸ 4ï¸âƒ£ `end`

```js
stream.on("end", () => {
  console.log("Finished reading");
});
```

---

## ğŸ”¸ 5ï¸âƒ£ `close`

When fd is closed.

---

## ğŸ”¸ 6ï¸âƒ£ `error`

VERY IMPORTANT.

If you donâ€™t handle error:  
ğŸ’¥ process crashes.

---

# ğŸ”¥ 5ï¸âƒ£ Flowing vs Paused â€” With Real Code

---

## Flowing Mode

```js
const stream = fs.createReadStream("file.txt");

stream.on("data", (chunk) => {
  console.log(chunk.toString());
});
```

Automatic flow.

---

## Paused Mode

```js
const stream = fs.createReadStream("file.txt");

stream.on("readable", () => {
  let chunk;
  while (null !== (chunk = stream.read())) {
    console.log(chunk.toString());
  }
});
```

Manual control.

---

# ğŸ”¥ 6ï¸âƒ£ Modern Async/Await Way (Very Important)

Streams now support async iteration.

This is the cleanest pattern.

```js
const fs = require("fs");

async function readFile() {
  const stream = fs.createReadStream("file.txt");

  for await (const chunk of stream) {
    console.log(chunk.toString());
  }

  console.log("Done");
}

readFile();
```

Behind the scenes:

- Uses async iterator
    
- Waits for each chunk
    
- Handles backpressure automatically
    

This is modern Node style.

---

# ğŸ”¥ 7ï¸âƒ£ Using `pipeline` (Production Safe Way)

```js
const { pipeline } = require("stream");
const fs = require("fs");

pipeline(
  fs.createReadStream("input.txt"),
  fs.createWriteStream("output.txt"),
  (err) => {
    if (err) console.error("Pipeline failed", err);
    else console.log("Pipeline succeeded");
  }
);
```

Why use this?

- Auto error handling
    
- Auto cleanup
    
- Prevents memory leaks
    

In production â†’ always use pipeline.

---

# ğŸ”¥ 8ï¸âƒ£ Real World Use Cases

---

## ğŸ“ 1ï¸âƒ£ Serving Files in HTTP

```js
const http = require("http");
const fs = require("fs");

http.createServer((req, res) => {
  const stream = fs.createReadStream("video.mp4");

  stream.pipe(res);
}).listen(3000);
```

Why?

- Doesnâ€™t load whole file in memory
    
- Efficient for large files
    

---

## ğŸ“Š 2ï¸âƒ£ Processing Large CSV

```js
const stream = fs.createReadStream("big.csv", {
  encoding: "utf8"
});

for await (const chunk of stream) {
  // process chunk
}
```

---

## ğŸ¥ 3ï¸âƒ£ Range Requests (Advanced)

```js
fs.createReadStream("video.mp4", {
  start: 1000000,
  end: 2000000
});
```

Used in:

- YouTube
    
- Netflix
    
- Resume downloads
    

---

# ğŸ”¥ 9ï¸âƒ£ Internal Lifecycle Summary

When reading starts:

```
open â†’ _read() â†’ push(chunk) â†’ data event
```

When buffer empty:

```
_read() called again
```

When file ends:

```
push(null) â†’ end event
```

That `push(null)` signals EOF.

---

# ğŸ† Interview-Level Knowledge

You should now confidently explain:

- What is highWaterMark?
    
- Difference between readable and data event?
    
- What triggers flowing mode?
    
- How backpressure works?
    
- How async iteration works with streams?
    
- Why pipeline is safer than pipe?
    

---

# ğŸš€ Next Level 

- Build our own custom Readable class
    
- Override `_read()` manually
    
- Simulate slow producer
    
- Explore internal buffer state (`_readableState`)
    
- Understand cork/uncork
